<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Survey</title>

    <link rel="icon" type="image/png" href="../../app/public/images/fb-favicon.png">

    <!-- Boostrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">

    <!-- Bootstrap Glyphicons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
        crossorigin="anonymous">

</head>

<body>

    <style>
        body {
            padding: 20px;
        }
    </style>

    <div class="container">

        <h2>
            <strong>Survey Questions</strong>
        </h2>
        <hr>
        <br>
        <h3>
            About You
        </h3>
        <h5>Name (Required)</h5>
        <input type="text" id="name" class="form-control" required>
        <br>
        <h5>Link to Photo Image (Required)</h5>
        <input type="text" id="photo" class="form-control" required>
        <br>
        <hr>
        <h3>Select an option from each dropdown menu</h3>
        <h5>Scale:</h5>
        <ul>
            <li>
                <h6>1 (Strongly Disagree)</h6>
            </li>
            <li>
                <h6>5 (Strongly Agree)</h6>
            </li>
        </ul>
        <hr>
        <!-- Q1 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 1
        </h4>
        <h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q1" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-1" type="button">1</button>
                <button class="dropdown-item question-1" type="button">2</button>
                <button class="dropdown-item question-1" type="button">3</button>
                <button class="dropdown-item question-1" type="button">4</button>
                <button class="dropdown-item question-1" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q2 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 2
        </h4>
        <h5>Generally speaking, you rely more on your experience than your imagination.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q2" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-2" type="button">1</button>
                <button class="dropdown-item question-2" type="button">2</button>
                <button class="dropdown-item question-2" type="button">3</button>
                <button class="dropdown-item question-2" type="button">4</button>
                <button class="dropdown-item question-2" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q3 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 3
        </h4>
        <h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q3" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-3" type="button">1</button>
                <button class="dropdown-item question-3" type="button">2</button>
                <button class="dropdown-item question-3" type="button">3</button>
                <button class="dropdown-item question-3" type="button">4</button>
                <button class="dropdown-item question-3" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q4 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 4
        </h4>
        <h5>You rarely do something just out of sheer curiosity.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q4" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-4" type="button">1</button>
                <button class="dropdown-item question-4" type="button">2</button>
                <button class="dropdown-item question-4" type="button">3</button>
                <button class="dropdown-item question-4" type="button">4</button>
                <button class="dropdown-item question-4" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q5 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 5
        </h4>
        <h5>People can rarely upset you.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q5" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-5" type="button">1</button>
                <button class="dropdown-item question-5" type="button">2</button>
                <button class="dropdown-item question-5" type="button">3</button>
                <button class="dropdown-item question-5" type="button">4</button>
                <button class="dropdown-item question-5" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q6 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 6
        </h4>
        <h5>It is often difficult for you to relate to other people’s feelings.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q6" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-6" type="button">1</button>
                <button class="dropdown-item question-6" type="button">2</button>
                <button class="dropdown-item question-6" type="button">3</button>
                <button class="dropdown-item question-6" type="button">4</button>
                <button class="dropdown-item question-6" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q7 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 7
        </h4>
        <h5>In a discussion, truth should be more important than people’s sensitivities.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q7" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-7" type="button">1</button>
                <button class="dropdown-item question-7" type="button">2</button>
                <button class="dropdown-item question-7" type="button">3</button>
                <button class="dropdown-item question-7" type="button">4</button>
                <button class="dropdown-item question-7" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q8 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 8
        </h4>
        <h5>You rarely get carried away by fantasies and ideas.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q8" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-8" type="button">1</button>
                <button class="dropdown-item question-8" type="button">2</button>
                <button class="dropdown-item question-8" type="button">3</button>
                <button class="dropdown-item question-8" type="button">4</button>
                <button class="dropdown-item question-8" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q9 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 9
        </h4>
        <h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or
            not.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q9" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-9" type="button">1</button>
                <button class="dropdown-item question-9" type="button">2</button>
                <button class="dropdown-item question-9" type="button">3</button>
                <button class="dropdown-item question-9" type="button">4</button>
                <button class="dropdown-item question-9" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>
        <!-- Q10 -->
        <!-- ======================================================================== -->
        <br>
        <h4>
            Question 10
        </h4>
        <h5>You feel more energetic after spending time with a group of people.</h5>
        <!-- Bootstrap Dropdown -->
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="q10" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                Select an Option
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                <button class="dropdown-item question-10" type="button">1</button>
                <button class="dropdown-item question-10" type="button">2</button>
                <button class="dropdown-item question-10" type="button">3</button>
                <button class="dropdown-item question-10" type="button">4</button>
                <button class="dropdown-item question-10" type="button">5</button>
            </div>
        </div>
        <br>
        <hr>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-lg btn-primary btn-block" id="submit" data-toggle="modal" data-target="#matchModal">
            <i class="fa fa-check-circle" aria-hidden="true"></i> Submit
        </button>
        <!-- Modal -->
        <div class="modal fade bd-example-modal-md" id="matchModal" role="dialog">
            <div class="modal-dialog modal-md">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Best Match!</h4>
                        <button type="button" class="close" data-dismiss="modal">x</button>
                    </div>
                    <div class="modal-body">
                        <div id="match-name"></div>
                        <div id="match-image"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-lg btn-primary" data-dismiss="modal" id="close">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <hr>

        <footer class="footer">
            <div class="container">
                <p>
                    <a href="/api/friends">API Friends List</a>
                    |
                    <a href="https://github.com/brijamfitz/FriendFinder">GitHub Repo</a>
                </p>
            </div>
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- JAVASCRIPT CODE -->
    <!-- ============================================================================ -->
    <script>
        $(document).ready(function () {
            var userScores = [];
            // Dropdown functions
            // =================================================================
            $('.question-1').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q1').text(this.innerHTML);
            });
            $('.question-2').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q2').text(this.innerHTML);
            });
            $('.question-3').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q3').text(this.innerHTML);
            });
            $('.question-4').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q4').text(this.innerHTML);
            });
            $('.question-5').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q5').text(this.innerHTML);
            });
            $('.question-6').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q6').text(this.innerHTML);
            });
            $('.question-7').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q7').text(this.innerHTML);
            });
            $('.question-8').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q8').text(this.innerHTML);
            });
            $('.question-9').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q9').text(this.innerHTML);
            });
            $('.question-10').click(function () {
                var value = parseInt($(this).text());
                console.log(value);
                userScores.push(value);
                console.log(userScores);
                $('#q10').text(this.innerHTML);
            });
            // Submit button on click event
            $('#submit').on('click', function () {
                // Build user object
                // =================================================================
                var userObj = {
                    name: $('#name').val(),
                    photo: $('#photo').val(),
                    scores: userScores
                }
                console.log(userObj);
                // Get correct match data logic
                $.get('api/friends', function (data) {
                    var resultsArr = [];

                    var tigerArr = [];
                    var tigerPosArr = [];
                    var tigerSum = 0;

                    var philArr = [];
                    var philPosArr = [];
                    var philSum = 0;

                    var roryArr = [];
                    var roryPosArr = [];
                    var rorySum = 0;

                    var vijayArr = [];
                    var vijayPosArr = [];
                    var vijaySum = 0;

                    var ernieArr = [];
                    var erniePosArr = [];
                    var ernieSum = 0;

                    // Tiger
                    // =================================================================
                    for (var i = 0; i <= 9; i++) {
                        if (userScores[i] !== data[0].scores[i]) {
                            tigerArr.push(userScores[i] - data[0].scores[i]);
                        }
                    }
                    console.log(tigerArr);
                    for (var i = 0; i < tigerArr.length; i++) {
                        var tigerPos = Math.abs(tigerArr[i]);
                        tigerPosArr.push(tigerPos);
                    }
                    console.log(tigerPosArr);
                    for (var i = 0; i < tigerPosArr.length; i++) {
                        tigerSum += tigerPosArr[i];
                    }
                    console.log("Tiger difference: " + tigerSum);
                    resultsArr.push(tigerSum);
                    // Phil
                    // =================================================================
                    for (var i = 0; i <= 9; i++) {
                        if (userScores[i] !== data[1].scores[i]) {
                            philArr.push(userScores[i] - data[1].scores[i]);
                        }
                    }
                    console.log(philArr);
                    for (var i = 0; i < philArr.length; i++) {
                        var philPos = Math.abs(philArr[i]);
                        philPosArr.push(philPos);
                    }
                    console.log(philPosArr);
                    for (var i = 0; i < philPosArr.length; i++) {
                        philSum += philPosArr[i];
                    }
                    console.log("Phil difference: " + philSum);
                    resultsArr.push(philSum);
                    // Rory
                    // =================================================================
                    for (var i = 0; i <= 9; i++) {
                        if (userScores[i] !== data[2].scores[i]) {
                            roryArr.push(userScores[i] - data[2].scores[i]);
                        }
                    }
                    console.log(roryArr);
                    for (var i = 0; i < roryArr.length; i++) {
                        var roryPos = Math.abs(roryArr[i]);
                        roryPosArr.push(roryPos);
                    }
                    console.log(roryPosArr);
                    for (var i = 0; i < roryPosArr.length; i++) {
                        rorySum += roryPosArr[i];
                    }
                    console.log("Rory difference: " + rorySum);
                    resultsArr.push(rorySum);
                    // Vijay
                    // =================================================================
                    for (var i = 0; i <= 9; i++) {
                        if (userScores[i] !== data[3].scores[i]) {
                            vijayArr.push(userScores[i] - data[3].scores[i]);
                        }
                    }
                    console.log(vijayArr);
                    for (var i = 0; i < vijayArr.length; i++) {
                        var vijayPos = Math.abs(vijayArr[i]);
                        vijayPosArr.push(vijayPos);
                    }
                    console.log(vijayPosArr);
                    for (var i = 0; i < vijayPosArr.length; i++) {
                        vijaySum += vijayPosArr[i];
                    }
                    console.log("Vijay difference: " + vijaySum);
                    resultsArr.push(vijaySum);
                    // Ernie
                    // =================================================================
                    for (var i = 0; i <= 9; i++) {
                        if (userScores[i] !== data[4].scores[i]) {
                            ernieArr.push(userScores[i] - data[4].scores[i]);
                        }
                    }
                    console.log(ernieArr);
                    for (var i = 0; i < ernieArr.length; i++) {
                        var erniePos = Math.abs(ernieArr[i]);
                        erniePosArr.push(erniePos);
                    }
                    console.log(erniePosArr);
                    for (var i = 0; i < erniePosArr.length; i++) {
                        ernieSum += erniePosArr[i];
                    }
                    console.log("Ernie difference: " + ernieSum);
                    resultsArr.push(ernieSum);
                    // =================================================================
                    // Find index of lowest number
                    // This will correspond with index in results array
                    console.log(resultsArr);
                    var idx = resultsArr.indexOf(Math.min.apply(null, resultsArr));
                    console.log(idx);
                    console.log(data);
                    if (data) {
                        $('#match-name').html('<h1>' + data[idx].name + '</h1>');
                        $('#match-image').html('<img style="height:200px;width:300px" src=' + '"' + data[idx].photo + '"/>');
                        console.log('You are matched!');
                    }
                })
                // AJAX post data to friends API 
                // =================================================================
                $.post("/api/friends", userObj,
                    function (data) {
                        if (data) {
                            console.log('You are matched!');
                        }
                        else {
                            console.log('Sorry, you did not match with anyone!');
                        }
                        
                    });
                    $('#name').val('');
                    $('#photo').val('')
                    $('#q1').text('Select an Option');
                    $('#q2').text('Select an Option');
                    $('#q3').text('Select an Option');
                    $('#q4').text('Select an Option');
                    $('#q5').text('Select an Option');
                    $('#q6').text('Select an Option');
                    $('#q7').text('Select an Option');
                    $('#q8').text('Select an Option');
                    $('#q9').text('Select an Option');
                    $('#q10').text('Select an Option');
            })
        })
    </script>

</body>

</html>